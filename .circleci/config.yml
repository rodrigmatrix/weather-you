version: 2.1

orbs:
  android: circleci/android@3.0.2  # Import the Android orb

jobs:
  generate-debug-phone-downloadable-apk:
    docker:
      - image: cimg/android:2024.11  # Use an Android Docker image
    working_directory: ~/project/weather-you
    steps:
      - checkout:
          path: ~/project

      - run:
          name: Process .env file variables
          command: echo "export $(grep -v '^#' .env | xargs)" >> $BASH_ENV
workflows:
  version: 1
  deploy:
    jobs:
      - android/deploy-to-play-store:
          executor:
            name: android/android-docker
            tag: "2022.0.7"
          base64-keystore: RELEASE_BASE64_KEYSTORE
          release-key-alias: RELEASE_KEY_ALIAS
          release-key-password: RELEASE_KEY_PASSWORD
          release-keystore: ./keystore
          release-store-password: RELEASE_STORE_PASSWORD
          keystore-properties-working-directory: '.'
          google-play-key: GOOGLE_PLAY_KEY
          lane-name: deploy
          fastlane-working-directory: '.'
